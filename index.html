<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Magic Mirror Dylan - Ultimate</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        #rotator {
            width: 100vh; height: 100vw; transform: rotate(90deg); transform-origin: center;
            position: absolute; top: 50%; left: 50%; margin-left: -50vh; margin-top: -50vw;
            display: flex; flex-direction: column; background: #000;
        }

        /* FOTO A PANTALLA COMPLETA */
        #foto-fondo {
            position: absolute; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 1.5s ease-in-out; opacity: 0.6; z-index: 1;
        }

        /* DISEÑO DE DATOS */
        .overlay {
            position: relative; z-index: 10; height: 100%; display: flex; 
            flex-direction: column; justify-content: space-between; padding: 60px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 40%, transparent 60%, rgba(0,0,0,0.8) 100%);
        }

        .header { display: flex; justify-content: space-between; align-items: flex-start; }
        #reloj { font-size: 8rem; font-weight: 200; line-height: 1; margin: 0; }
        #fecha { font-size: 2.2rem; opacity: 0.8; margin-top: 15px; text-transform: capitalize; }
        
        .clima-box { text-align: right; }
        #clima-temp { font-size: 6rem; font-weight: bold; margin: 0; }
        .clima-icon { font-size: 7rem; color: #FFD700; margin-bottom: 10px; }
        #clima-info { font-size: 1.6rem; opacity: 0.9; line-height: 1.5; }

        #frase-box { text-align: center; font-size: 2.5rem; font-weight: 300; font-style: italic; padding: 0 10%; margin-bottom: 20px; }

        /* MODO SPOTIFY FULL SCREEN (ESTILO MERCADO LIBRE) */
        #spotify-fullscreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; z-index: 100; display: none;
            flex-direction: column; align-items: center; justify-content: center; padding: 60px;
        }
        #spotify-fullscreen.active { display: flex; }
        
        #placa-album { width: 55vh; height: 55vh; border-radius: 25px; box-shadow: 0 40px 100px rgba(0,0,0,1); margin-bottom: 60px; }
        #placa-titulo { font-size: 4.5rem; font-weight: bold; margin: 0; text-align: center; width: 90%; }
        #placa-artista { font-size: 2.8rem; color: #1DB954; margin: 20px 0 0 0; }

        .placa-controls { width: 85%; margin-top: 60px; }
        .placa-bar { width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; margin-bottom: 50px; }
        .placa-fill { width: 45%; height: 100%; background: #1DB954; border-radius: 5px; }
        .placa-icons { display: flex; justify-content: space-between; align-items: center; font-size: 6rem; }
    </style>
</head>
<body>
    <div id="rotator">
        <div id="foto-fondo"></div>

        <div id="spotify-fullscreen">
            <img id="placa-album" src="" alt="">
            <div id="placa-titulo">Título</div>
            <div id="placa-artista">Artista</div>
            <div class="placa-controls">
                <div class="placa-bar"><div class="placa-fill"></div></div>
                <div class="placa-icons">
                    <span class="material-icons-round">shuffle</span>
                    <span class="material-icons-round" style="font-size: 8rem;">skip_previous</span>
                    <span class="material-icons-round" style="font-size: 11rem; color:#1DB954;">play_circle_filled</span>
                    <span class="material-icons-round" style="font-size: 8rem;">skip_next</span>
                    <span class="material-icons-round">repeat</span>
                </div>
            </div>
        </div>

        <div class="overlay">
            <div class="header">
                <div>
                    <p id="reloj">00:00</p>
                    <p id="fecha">Cargando fecha...</p>
                </div>
                <div class="clima-box">
                    <span class="material-icons-round clima-icon" id="clima-icon">wb_sunny</span>
                    <p id="clima-temp">--°C</p>
                    <div id="clima-info">Rosario<br>Humedad: --% | Viento: --km/h</div>
                </div>
            </div>
            <div id="frase-box">"La disciplina es el puente entre tus metas y tus logros."</div>
        </div>
    </div>

    <script>
        const GITHUB_USER = "dylandamian17";
        const REPO_NAME = "mi-espejo";
        const LASTFM_USER = "Dylandd425";
        const LASTFM_KEY = "9e7f2febccc739bfae8fda70db9eb9bd";
        const WEATHER_KEY = "9c73a28867a7fe53db5718310609a992";

        const FRASES = [
            "La disciplina supera al talento.", "El orden externo crea paz interna.",
            "La acción cura el miedo.", "Lo que no se mide, no se mejora.",
            "Enfócate en la solución, no en el problema.", "La paz mental es la meta final."
        ];

        // 1. FOTOS FULL SCREEN
        let fotos = [];
        async function getPhotos() {
            try {
                const res = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/contents/fotos`);
                const data = await res.json();
                fotos = data.filter(f => f.name.match(/\.(jpg|jpeg|png|gif)$/i)).map(f => f.download_url);
                updateFoto();
            } catch (e) { }
        }
        let fIdx = 0;
        function updateFoto() {
            if(fotos.length > 0) {
                document.getElementById('foto-fondo').style.backgroundImage = `url('${fotos[fIdx]}')`;
                fIdx = (fIdx + 1) % fotos.length;
            }
        }
        setInterval(updateFoto, 60000); getPhotos();

        // 2. CLIMA DETALLADO
        async function updateWeather() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Rosario,AR&appid=${WEATHER_KEY}&units=metric&lang=es`);
                const data = await res.json();
                document.getElementById('clima-temp').innerText = `${Math.round(data.main.temp)}°C`;
                document.getElementById('clima-info').innerHTML = `Rosario<br>Humedad: ${data.main.humidity}% | Viento: ${Math.round(data.wind.speed * 3.6)}km/h<br>${data.weather[0].description}`;
                const iconMap = {"01":"wb_sunny","02":"cloud","03":"cloud","04":"cloud","09":"grain","10":"grain","11":"thunderstorm","13":"ac_unit","50":"filter_drama"};
                document.getElementById('clima-icon').innerText = iconMap[data.weather[0].icon.substring(0,2)] || "cloud";
            } catch (e) { }
        }
        setInterval(updateWeather, 900000); updateWeather();

        // 3. SPOTIFY FULL SCREEN
        async function checkMusic() {
            try {
                const res = await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${LASTFM_USER}&api_key=${LASTFM_KEY}&format=json&limit=1`);
                const data = await res.json();
                const track = data.recenttracks.track[0];
                const isPlaying = track['@attr'] && track['@attr'].nowplaying === 'true';
                
                const placa = document.getElementById('spotify-fullscreen');
                if (isPlaying) {
                    document.getElementById('placa-album').src = track.image[3]['#text'].replace('300x300','600x600');
                    document.getElementById('placa-titulo').innerText = track.name;
                    document.getElementById('placa-artista').innerText = track.artist['#text'];
                    placa.classList.add('active');
                } else {
                    placa.classList.remove('active');
                }
            } catch (e) { }
        }
        setInterval(checkMusic, 10000);

        // 4. RELOJ Y FECHA
        setInterval(() => {
            const d = new Date();
            document.getElementById('reloj').innerText = d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('fecha').innerText = d.toLocaleDateString('es-AR', { weekday: 'long', day: 'numeric', month: 'long' });
        }, 1000);

        let pIdx = 0;
        setInterval(() => {
            document.getElementById('frase-box').innerText = `"${FRASES[pIdx]}"`;
            pIdx = (pIdx + 1) % FRASES.length;
        }, 60000);
    </script>
</body>
</html>
