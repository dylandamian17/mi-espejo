<!DOCTYPE html>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Magic Mirror Dylan - FINAL AUDITED</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root { --accent: #1DB954; --glass: rgba(10, 10, 10, 0.9); --text-dim: #b3b3b3; --event-color: #4cd964; }
        body { margin: 0; background: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        
        #rotator {
            width: 100vh; height: 100vw; transform: rotate(-90deg); transform-origin: center;
            position: absolute; top: 50%; left: 50%; margin-left: -50vh; margin-top: -50vw;
            display: flex; flex-direction: column; background: #000;
        }

        #loader {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Roboto Mono', monospace; font-size: 1.5rem; letter-spacing: 3px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        .layer {
            position: absolute; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            background-color: #000;
            transition: opacity 2s ease-in-out; opacity: 0; z-index: 1;
        }
        .active { opacity: 0.9 !important; z-index: 2; }
        .instant { transition: none !important; opacity: 0.9 !important; z-index: 2; }

        .overlay {
            position: relative; z-index: 10; height: 100%; 
            display: flex; flex-direction: column; justify-content: space-between; padding: 40px 50px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.85) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.9) 100%);
        }

        .shift-protect { transition: transform 1s ease-in-out; will-change: transform; }

        .header { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .time-col { display: flex; flex-direction: column; }
        #reloj { font-family: 'Roboto Mono', monospace; font-size: 4.5rem; font-weight: 400; line-height: 0.9; letter-spacing: -2px; text-shadow: 0 4px 20px rgba(0,0,0,0.8); }
        #am-pm { font-size: 1.5rem; font-weight: 300; margin-top: 5px; opacity: 0.8; }
        #fecha { font-size: 1.1rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 2px; margin-top: 10px; font-weight: 600; text-shadow: 0 2px 10px rgba(0,0,0,1); color: var(--text-dim); }

        .info-col { display: flex; flex-direction: column; align-items: flex-end; text-align: right; }
        .clima-row { display: flex; align-items: center; gap: 15px; margin-bottom: 5px; }
        #clima-temp { font-family: 'Roboto Mono', monospace; font-size: 3.5rem; font-weight: 300; text-shadow: 0 4px 15px rgba(0,0,0,0.8); }
        #clima-icon { width: 50px; height: 50px; }
        .clima-details { font-size: 0.9rem; font-weight: 500; opacity: 0.9; text-shadow: 0 2px 5px rgba(0,0,0,1); margin-bottom: 2px; }
        #clima-desc { font-size: 0.85rem; text-transform: uppercase; opacity: 0.7; letter-spacing: 1px; margin-bottom: 20px; }

        #calendar-box { margin-top: 10px; display: flex; flex-direction: column; gap: 8px; align-items: flex-end; }
        .event-item { font-size: 0.85rem; text-shadow: 0 2px 4px rgba(0,0,0,1); max-width: 300px; line-height: 1.3; }
        .event-date { color: var(--event-color); font-weight: 700; margin-right: 5px; }
        .event-title { color: white; font-weight: 400; }

        #frase-box { 
            text-align: center; font-size: 1.5rem; font-weight: 400; font-style: italic; line-height: 1.5;
            max-width: 90%; align-self: center; opacity: 0; 
            text-shadow: 0 2px 20px #000; transition: opacity 1s ease;
        }

        #spotify-card { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; align-items: center; justify-content: center; width: 100%; z-index: 50; }
        #spotify-card.visible { display: flex; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(30px); padding: 40px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.15); display: flex; align-items: center; gap: 40px; box-shadow: 0 40px 100px rgba(0,0,0,0.9); }
        .vinyl-container { position: relative; width: 220px; height: 220px; }
        .vinyl { position: absolute; top: 2px; left: 40px; width: 215px; height: 215px; background: radial-gradient(circle, #1a1a1a 30%, #000 100%); border-radius: 50%; border: 1px solid #333; box-shadow: 5px 5px 20px rgba(0,0,0,0.7); animation: spin 6s linear infinite; z-index: -1; }
        .vinyl::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 40%, transparent 60%, rgba(255,255,255,0.05) 100%); }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        #album-art { width: 220px; height: 220px; border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.6); z-index: 2; object-fit: cover; }
        .track-meta { display: flex; flex-direction: column; max-width: 300px; }
        #t-name { font-size: 2rem; font-weight: 700; margin: 0; line-height: 1.1; }
        #t-artist { font-size: 1.4rem; color: var(--accent); margin-top: 10px; font-weight: 400; opacity: 0.9; }
    </style>
</head>
<body>
    <div id="rotator">
        <div id="loader">INICIANDO SISTEMA...</div>
        <div id="layer1" class="layer"></div>
        <div id="layer2" class="layer"></div>
        <div id="spotify-card">
            <div class="glass-panel">
                <div class="vinyl-container"><div class="vinyl"></div><img id="album-art" src="" alt=""></div>
                <div class="track-meta"><p id="t-name">Song</p><p id="t-artist">Artist</p></div>
            </div>
        </div>
        <div class="overlay">
            <div class="header shift-protect">
                <div class="time-col">
                    <div id="reloj">--:--</div>
                    <div id="am-pm">--</div>
                    <div id="fecha">---</div>
                </div>
                <div class="info-col">
                    <div class="clima-row">
                        <div id="clima-temp">--°C</div>
                        <img id="clima-icon" src="" alt="clima">
                    </div>
                    <div class="clima-details" id="clima-stats">--</div>
                    <div id="clima-desc">--</div>
                    <div id="calendar-box"></div>
                </div>
            </div>
            <div id="frase-box" class="shift-protect"></div>
        </div>
    </div>

    <script>
        const CONF = { 
            githubUser: "dylandamian17", 
            repo: "mi-espejo", 
            lastfmUser: "Dylandd425", 
            lastfmKey: "9e7f2febccc739bfae8fda70db9eb9bd", 
            weatherKey: "9c73a28867a7fe53db5718310609a992",
            calendarUrl: "https://calendar.google.com/calendar/ical/dylan.damian17%40gmail.com/private-b5a2af32aeef93ac1c646922faf69b51/basic.ics" 
        };

        const FRASES = [
            "La disciplina tarde o temprano vencerá a la inteligencia.", "No te detengas cuando estés cansado, detente cuando hayas terminado.", "Tu única competencia es quien eras ayer.", "El dolor de la disciplina es temporal; el dolor del arrepentimiento es para siempre.", "La motivación te pone en marcha, el hábito te mantiene.", "Hazlo ahora. A veces 'luego' se convierte en 'nunca'.", "El éxito es la suma de pequeños esfuerzos repetidos día tras día.", "No busques excusas, busca resultados.", "Sé más fuerte que tus excusas.", "La calidad de tus pensamientos determina la calidad de tu vida.", "No es lo que te pasa, es cómo reaccionas a lo que te pasa.", "Domina tu mente o ella te dominará a ti.", "La incomodidad es el precio del crecimiento.", "Si quieres algo que nunca has tenido, debes hacer algo que nunca has hecho.", "El primer paso no te lleva a donde quieres ir, pero te saca de donde estás.", "La constancia es la clave del éxito.", "No esperes el momento perfecto, toma el momento y hazlo perfecto.", "El miedo es una reacción, el coraje es una decisión.", "Trabaja en silencio, deja que tu éxito haga el ruido.", "Lo que no se mide, no se puede mejorar.", "La acción cura el miedo y la procrastinación.", "La paz mental es la verdadera meta.", "Tu tiempo es limitado, no lo malgastes viviendo la vida de otro.", "El orden externo refleja el orden interno.", "Sé el arquitecto de tu propio destino.", "Las oportunidades no pasan, las creas.", "Cree que puedes y ya estás a mitad de camino.", "El fracaso es solo la oportunidad de comenzar de nuevo con más inteligencia.", "Acepta lo que no puedes cambiar, ten el coraje de cambiar lo que sí puedes.", "La excelencia no es un acto, es un hábito.", "No cuentes los días, haz que los días cuenten.", "La verdadera libertad es la autodisciplina.", "Si no te desafía, no te cambia.", "El momento para actuar es ahora.", "Mantén la calma y sigue adelante.", "La paciencia es amarga, pero su fruto es dulce.", "Invierte en ti mismo, es la mejor inversión.", "La suerte favorece a la mente preparada.", "El conocimiento es poder, pero la acción es la clave.", "No te compares con nadie, mantén la cabeza alta.", "La vida es 10% lo que te sucede y 90% cómo reaccionas ante ello.", "Si no puedes hacer grandes cosas, haz cosas pequeñas de una manera grandiosa.", "El éxito no es definitivo, el fracaso no es fatal: es el coraje para continuar lo que cuenta.", "La mejor venganza es un éxito masivo.", "No permitas que el ruido de las opiniones ajenas silencie tu voz interior.", "La única forma de hacer un gran trabajo es amar lo que haces.", "La vida se encoge o se expande en proporción a tu coraje.", "No dejes que el ayer ocupe demasiado del hoy.", "El hombre que mueve una montaña comienza cargando pequeñas piedras.", "La mejor manera de predecir el futuro es crearlo.", "La felicidad no es algo hecho. Proviene de tus propias acciones.", "La mente es todo. En lo que piensas te conviertes.", "Cáete siete veces, levántate ocho.", "Todo lo que siempre has querido está al otro lado del miedo.", "El momento es ahora.", "Enfócate en la solución, no en el problema.", "Actúa como si lo que haces marca la diferencia. Lo hace.", "El único límite para nuestra realización del mañana serán nuestras dudas de hoy.", "No esperes. El tiempo nunca será el 'justo'.", "Puedes si crees que puedes.", "El secreto para salir adelante es empezar.", "La mejor preparación para mañana es hacer lo mejor hoy.", "Cree en ti mismo y en todo lo que eres.", "Mantén tu rostro siempre hacia la luz del sol y las sombras caerán detrás de ti.", "El optimismo perpetuo es un multiplicador de fuerza.", "La disciplina es el puente entre metas y logros.", "Menos charla, más acción."
        ];

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === 'Enter') { window.location.href = 'arte.html'; }
        });

        let fotos = [], fIdx = 0, currentLayer = 1, isFirstLoad = true;
        async function initPhotos() {
            try {
                const res = await fetch(`https://api.github.com/repos/${CONF.githubUser}/${CONF.repo}/contents/fotos`);
                const data = await res.json();
                fotos = data.filter(f => f.name.match(/\.(jpg|jpeg|png|gif)$/i)).map(f => f.download_url);
                if(fotos.length > 0) loadNextPhoto();
            } catch (e) { document.getElementById('loader').innerText = "ERROR FOTOS"; }
        }
        function loadNextPhoto() {
            if (!fotos.length) return;
            const nextLayer = isFirstLoad ? 1 : (currentLayer === 1 ? 2 : 1);
            const imgUrl = fotos[fIdx];
            const turboUrl = `https://wsrv.nl/?url=${encodeURIComponent(imgUrl)}&w=1080&h=1920&fit=cover&output=webp`;
            const tempImg = new Image();
            tempImg.src = turboUrl;
            tempImg.onload = () => {
                const nextEl = document.getElementById(`layer${nextLayer}`);
                nextEl.style.backgroundImage = `url('${turboUrl}')`;
                if (isFirstLoad) {
                    nextEl.classList.add('instant'); 
                    document.getElementById('loader').style.display = 'none';
                    isFirstLoad = false;
                } else {
                    nextEl.classList.remove('instant');
                    nextEl.classList.add('active');
                    if(document.getElementById(`layer${currentLayer}`)) {
                        document.getElementById(`layer${currentLayer}`).classList.remove('active');
                    }
                }
                currentLayer = nextLayer;
                fIdx = (fIdx + 1) % fotos.length;
                setTimeout(loadNextPhoto, 45000);
            };
        }

        async function fetchCalendar() {
            try {
                const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(CONF.calendarUrl);
                const res = await fetch(proxyUrl);
                const text = await res.text();
                parseICS(text);
            } catch (e) { console.error("Calendario Error", e); }
        }

        function parseICS(data) {
            const events = [];
            const lines = data.split(/\r\n|\n|\r/);
            let ev = null;
            lines.forEach(l => {
                if (l.startsWith('BEGIN:VEVENT')) ev = {};
                if (ev && l.startsWith('DTSTART')) ev.start = parseIcsDate(l.split(':')[1]);
                if (ev && l.startsWith('SUMMARY')) ev.sum = l.substring(8);
                if (l.startsWith('END:VEVENT')) { if(ev.start > new Date()) events.push(ev); ev = null; }
            });
            const next = events.sort((a,b) => a.start - b.start).slice(0,3);
            const box = document.getElementById('calendar-box');
            box.innerHTML = '';
            next.forEach(i => {
                const d = i.start.toLocaleDateString('es-AR', {day:'numeric', month:'short'}).toUpperCase() + " " + i.start.getHours() + ":" + i.start.getMinutes().toString().padStart(2,'0');
                box.innerHTML += `<div class="event-item"><span class="event-date">${d}</span> <span class="event-title">${i.sum}</span></div>`;
            });
        }

        function parseIcsDate(s) {
            const y=s.substr(0,4), m=s.substr(4,2)-1, d=s.substr(6,2), h=s.substr(9,2), min=s.substr(11,2);
            return new Date(Date.UTC(y,m,d,h,min));
        }
        setInterval(fetchCalendar, 300000);

        async function updateWeather() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=Rosario,AR&appid=${CONF.weatherKey}&units=metric&lang=es`);
                const data = await res.json();
                document.getElementById('clima-temp').innerText = `${Math.round(data.main.temp)}°C`;
                document.getElementById('clima-icon').src = `http://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
                document.getElementById('clima-desc').innerText = data.weather[0].description.toUpperCase();
                document.getElementById('clima-stats').innerText = `H: ${data.main.humidity}% | V: ${Math.round(data.wind.speed*3.6)}km/h`;
            } catch (e) {}
        }
        setInterval(updateWeather, 600000);

        setInterval(() => {
            const d = new Date();
            let h = d.getHours(); const am = h >= 12 ? 'p.m.' : 'a.m.';
            h = h % 12 || 12;
            document.getElementById('reloj').innerText = `${h}:${d.getMinutes().toString().padStart(2,'0')}`;
            document.getElementById('am-pm').innerText = am;
            document.getElementById('fecha').innerText = d.toLocaleDateString('es-AR', { weekday: 'long', day: 'numeric', month: 'short' }).toUpperCase();
        }, 1000);

        let pIdx = 0;
        setInterval(() => {
            const b = document.getElementById('frase-box');
            b.style.opacity = 0;
            setTimeout(() => { b.innerText = `"${FRASES[pIdx]}"`; b.style.opacity = 0.9; pIdx = (pIdx + 1) % FRASES.length; }, 1000);
        }, 15000);
        
        setInterval(() => {
            const x = Math.floor(Math.random()*6)-3, y = Math.floor(Math.random()*6)-3;
            document.querySelectorAll('.shift-protect').forEach(el => el.style.transform = `translate(${x}px, ${y}px)`);
        }, 20000);

        async function checkMusic() {
            try {
                const res = await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${CONF.lastfmUser}&api_key=${CONF.lastfmKey}&format=json&limit=1`);
                const data = await res.json();
                const t = data.recenttracks.track[0];
                const card = document.getElementById('spotify-card');
                if (t['@attr'] && t['@attr'].nowplaying === 'true') {
                    document.getElementById('album-art').src = t.image[3]['#text'].replace('300x300','600x600');
                    document.getElementById('t-name').innerText = t.name;
                    document.getElementById('t-artist').innerText = t.artist['#text'];
                    card.classList.add('visible');
                } else { card.classList.remove('visible'); }
            } catch (e) {}
        }
        setInterval(checkMusic, 5000);

        initPhotos(); updateWeather(); fetchCalendar();
    </script>
</body>
</html>
